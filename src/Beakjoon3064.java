import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

public class Beakjoon3064 {
    private static int ans= 0;
    private static final int[][] movePoint= {
            {-1,1,0,1,1,1},
            {-1,-1,0,-1,1,-1},
            {1,-1,1,0,1,1},
            {-1,-1,-1,0,-1,1}};
    //private static int movePoint[][]= {{-1,-1,0,-1,1,-1}, {-1,1,0,1,1,1}, {1,1,1,0,1,-1}, {-1,1,-1,0,-1,-1}};
    private static final int[] vertex= {-1,1,1,1,1,-1,-1,-1};

    public static void main(String[] args)throws IOException {

        BufferedReader br= new BufferedReader(new InputStreamReader(System.in));

        int t= Integer.parseInt(br.readLine());
        StringBuilder sb2= new StringBuilder();

        for(int i=0;i<t;i++){

            int n= Integer.parseInt(br.readLine());
            char[][] board= new char[n][n];

            if(n>2) {
                for (int r = 0; r < n; r++) {
                    String str = br.readLine();
                    for (int c = 0; c < n; c++) {
                        board[r][c] = str.charAt(c);
                    }
                }

                calc(board);
                if (n > 4) ans += Math.pow(n - 4, 2);
            }
            else{
                for(int p=0;p<n;p++){
                    br.readLine();
                }
            }
            sb2.append(ans).append("\n");
            ans= 0;
            //print_clear(board);
        }

        System.out.print(sb2);
    }

    private static void calc(char[][] board){
        for(int r=0;r<board.length;r++){
            for(int c=0;c<board[0].length;){

                if(r==0 && ((1<=c && c<= board.length-2))){
                    //top 0
                    mincheck(r,c,0, board);
                }
                else if(r== board.length-1 && ((1<=c && c<= board.length-2))){
                    //bottom 1
                    mincheck(r,c,1, board);
                }
                else if((1<=r && r<= board.length-2) && c==0){
                    //left 2
                    mincheck(r,c,2, board);
                }
                else if((1<=r && r<= board.length-2) && c==board.length-1){
                    //right 3
                    mincheck(r,c,3, board);
                }
                else{
                    //vertex 4
                    mincheck(r,c, board);
                }

                if(r==0 || r==board.length-1) c++;
                else c+= (board.length-1);
            }
            //System.out.println();
        }
    }
    private static void mincheck(int r, int c, int p, char[][] board){
        int mine= board[r][c]-'0';
        int m= 0;

        for(int i=0;i<6;i+=2){
            int dx= r+movePoint[p][i+1];
            int dy= c+movePoint[p][i];

            if((0<=dx && dx<board.length) && (0<=dy && dy<board.length)){
                char check= board[dx][dy];
                if(check=='*') m++;
                else if(check=='#'){
                    if (mine > m) {
                        m++;
                        board[dx][dy] = '*';
                        ans++;
                    }
                    else {
                        board[dx][dy] = 'X';
                    }
                }

            }
        }
    }
    private static void mincheck(int r, int c, char[][] board){
        int mine= board[r][c]-'0';
        int m= 0;

        for(int i=0;i<6;i+=2){
            int dx= r+vertex[i+1];
            int dy= c+vertex[i];

            if((0<=dx && dx<board.length) && (0<=dy && dy<board.length)){
                char check= board[dx][dy];
                if(check=='*') m++;
                else if(check=='#'){
                    if (mine > m) {
                        m++;
                        board[dx][dy] = '*';
                        ans++;
                    }
                    else {
                        board[dx][dy] = 'X';
                    }
                }

            }
        }
    }
}
/*
1
5
11211
1###1
2###2
1###1
11211


4
6
111000
2####0
3####1
3####1
2####1
112110
5
11211
1###1
2###2
1###1
11211
7
1122211
1#####1
2#####2
2#####2
3#####2
2#####1
1133210
7
1122210
1#####1
2#####2
2#####3
3#####2
2#####1
1133210


=======
111000
2*###0
3***#1
3****1
2*#*#1
112110

11211
1*#*1
2#*#2
1*#*1
11211

1122211
1*#*#*1
2#***#2
2*****2
3*****2
2****#1
1133210

1122210
1*#**#1
2#****2
2*****3
3*****2
2****#1
1133210

10
5
20
20

10
5
20
20

 */
/*
9345
9345

1
100
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1##################################################################################################1
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
 */